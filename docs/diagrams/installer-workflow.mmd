%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#fbbf24', 'primaryTextColor': '#fff', 'primaryBorderColor': '#00d4ff', 'lineColor': '#00d4ff', 'secondaryColor': '#1a1a2e', 'tertiaryColor': '#16213e'}}}%%
flowchart TD
    subgraph INICIO["ðŸš€ INÃCIO"]
        START([ðŸŽµ TSiJUKEBOX Installer v7.0.0])
        MODE{{"ðŸŽ® Modo de InstalaÃ§Ã£o"}}
        START --> MODE
        MODE -->|full| FULL[ðŸŽµ Full - Completo]
        MODE -->|kiosk| KIOSK[ðŸ–¥ï¸ Kiosk - Touch]
        MODE -->|server| SERVER[ðŸ–§ Server - Headless]
        MODE -->|minimal| MINIMAL[âš¡ Minimal - Essencial]
    end

    subgraph FASE1["ðŸ“Š FASE 1-2: ANÃLISE"]
        F1[/"1ï¸âƒ£ AnÃ¡lise de Hardware"/]
        F1_DETAIL["CPU â€¢ RAM â€¢ GPU â€¢ Disco"]
        F2[/"2ï¸âƒ£ VerificaÃ§Ã£o do Sistema"/]
        F2_DETAIL["pacman â€¢ AUR helper â€¢ DependÃªncias"]
        F1 --> F1_DETAIL --> F2 --> F2_DETAIL
    end

    subgraph FASE2["ðŸ”§ FASE 3-7: CORE"]
        F3[/"3ï¸âƒ£ Node.js & npm"/]
        F4[/"4ï¸âƒ£ Firewall (UFW)"/]
        F5[/"5ï¸âƒ£ NTP Sync"/]
        F6[/"6ï¸âƒ£ Fontes"/]
        F7[/"7ï¸âƒ£ Ãudio (PipeWire)"/]
        F3 --> F4 --> F5 --> F6 --> F7
    end

    subgraph FASE3["ðŸ’¾ FASE 8-11: INFRAESTRUTURA"]
        F8[/"8ï¸âƒ£ Supabase DB"/]
        F9[/"9ï¸âƒ£ Nginx Proxy"/]
        F10[/"ðŸ”Ÿ Monitoring"/]
        F10_DETAIL["Grafana â€¢ Prometheus"]
        F11[/"1ï¸âƒ£1ï¸âƒ£ Cloud Backup"/]
        F11_DETAIL["rclone"]
        F8 --> F9 --> F10 --> F10_DETAIL --> F11 --> F11_DETAIL
    end

    subgraph FASE4["ðŸŽµ FASE 12-14: SPOTIFY STACK"]
        F12[/"1ï¸âƒ£2ï¸âƒ£ Spotify Client"/]
        F13[/"1ï¸âƒ£3ï¸âƒ£ Spicetify"/]
        F13_DETAIL["Temas â€¢ ExtensÃµes"]
        F14[/"1ï¸âƒ£4ï¸âƒ£ Spotify CLI"/]
        F14_DETAIL["spotify-tui â€¢ spotifyd"]
        F12 --> F13 --> F13_DETAIL --> F14 --> F14_DETAIL
    end

    subgraph FASE5["ðŸ–¥ï¸ FASE 15-18: AMBIENTE"]
        F15[/"1ï¸âƒ£5ï¸âƒ£ Kiosk Mode"/]
        F15_DETAIL["Openbox â€¢ Chromium"]
        F16[/"1ï¸âƒ£6ï¸âƒ£ Voice Control"/]
        F17[/"1ï¸âƒ£7ï¸âƒ£ Dev Tools"/]
        F18[/"1ï¸âƒ£8ï¸âƒ£ Autologin"/]
        F15 --> F15_DETAIL --> F16 --> F17 --> F18
    end

    subgraph FASE6["ðŸ“¦ FASE 19-21: APLICAÃ‡ÃƒO"]
        F19[/"1ï¸âƒ£9ï¸âƒ£ Git Clone"/]
        F19_DETAIL["github.com/B0yZ4kr14/TSiJUKEBOX"]
        F20[/"2ï¸âƒ£0ï¸âƒ£ Frontend Build"/]
        F20_DETAIL["npm install â€¢ npm run build"]
        F21[/"2ï¸âƒ£1ï¸âƒ£ Systemd Services"/]
        F19 --> F19_DETAIL --> F20 --> F20_DETAIL --> F21
    end

    subgraph FASE7["ðŸ”’ FASE 22-26: FINALIZAÃ‡ÃƒO"]
        F22[/"2ï¸âƒ£2ï¸âƒ£ SSL Setup"/]
        F22_DETAIL{{"SSL Mode"}}
        F22_SELF["Self-Signed"]
        F22_LE["Let's Encrypt"]
        F23[/"2ï¸âƒ£3ï¸âƒ£ Avahi/mDNS"/]
        F24[/"2ï¸âƒ£4ï¸âƒ£ Fish Shell"/]
        F25[/"2ï¸âƒ£5ï¸âƒ£ GitHub CLI"/]
        F26[/"2ï¸âƒ£6ï¸âƒ£ VerificaÃ§Ã£o Final"/]
        F22 --> F22_DETAIL
        F22_DETAIL -->|self-signed| F22_SELF --> F23
        F22_DETAIL -->|letsencrypt| F22_LE --> F23
        F23 --> F24 --> F25 --> F26
    end

    subgraph FIM["âœ… CONCLUSÃƒO"]
        VERIFY{{"VerificaÃ§Ã£o OK?"}}
        SUCCESS([ðŸŽ‰ InstalaÃ§Ã£o Completa!])
        ROLLBACK[ðŸ”„ Rollback]
        VERIFY -->|âœ… Sim| SUCCESS
        VERIFY -->|âŒ NÃ£o| ROLLBACK
        ROLLBACK --> F1
    end

    %% ConexÃµes entre subgraphs
    FULL --> F1
    KIOSK --> F1
    SERVER --> F1
    MINIMAL --> F1
    
    F2_DETAIL --> F3
    F7 --> F8
    F11_DETAIL --> F12
    F14_DETAIL --> F15
    F18 --> F19
    F21 --> F22
    F26 --> VERIFY

    %% Estilos
    classDef inicio fill:#1a1a2e,stroke:#fbbf24,stroke-width:2px,color:#fff
    classDef fase fill:#16213e,stroke:#00d4ff,stroke-width:2px,color:#fff
    classDef detail fill:#0f3460,stroke:#00d4ff,stroke-width:1px,color:#ccc
    classDef decision fill:#e94560,stroke:#fff,stroke-width:2px,color:#fff
    classDef success fill:#22c55e,stroke:#fff,stroke-width:2px,color:#fff
    classDef rollback fill:#ef4444,stroke:#fff,stroke-width:2px,color:#fff

    class START,MODE,FULL,KIOSK,SERVER,MINIMAL inicio
    class F1,F2,F3,F4,F5,F6,F7,F8,F9,F10,F11,F12,F13,F14,F15,F16,F17,F18,F19,F20,F21,F22,F23,F24,F25,F26 fase
    class F1_DETAIL,F2_DETAIL,F10_DETAIL,F11_DETAIL,F13_DETAIL,F14_DETAIL,F15_DETAIL,F19_DETAIL,F20_DETAIL,F22_SELF,F22_LE detail
    class VERIFY,F22_DETAIL decision
    class SUCCESS success
    class ROLLBACK rollback
